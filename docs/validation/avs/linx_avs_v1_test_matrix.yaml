version: linx-avs-v1
status: draft
last_updated: "2026-02-07"

profiles:
  LNX-S32: "Scalar 32-bit, freestanding, little-endian, no MMU"
  LNX-S64: "Scalar 64-bit, freestanding, little-endian, no MMU"
  LNX-PRIV: "Adds ACR/SSR trap envelope behavior (no full OS/MMU required)"
  LNX-ATOM: "Adds atomics + ordering qualifiers"
  LNX-FP: "Adds scalar FP + FCSR behavior"
  LNX-VPAR: "Enables vector blocks (BSTART.VPAR)"
  LNX-VSEQ: "Enables vector blocks (BSTART.VSEQ)"
  LNX-TILE: "Enables tile blocks / TAU (not required for v1 pass)"

pass_fail_rules:
  pass: "Expected architectural effects observed; no unexpected traps."
  fail: "Unexpected trap, wrong architectural result, or Block ISA invariant violation."
  trap_expected_pass: "Correct trap class/cause and precise PC capture (BPC/TPC) with no partial side effects."

tests:
  - id: AVS-DEC-001
    area: DEC
    profiles: [LNX-S32, LNX-S64]
    requirement: "Any encoding not matched by the ISA catalog traps as illegal instruction."
    pass_fail: "QEMU and RTL (when available) trap on the same byte sequence at the same TPC; no partial side effects."

  - id: AVS-DEC-002
    area: DEC
    profiles: [LNX-S32, LNX-S64]
    requirement: "All-zero 16-bit encoding (0x0000) is handled intentionally as C.BSTOP (or defined illegal), consistently."
    pass_fail: "Executing 0x0000 at a valid TPC produces the defined behavior."

  - id: AVS-TOOL-001
    area: TOOL
    profiles: [LNX-S32, LNX-S64, LNX-PRIV, LNX-ATOM, LNX-FP, LNX-VPAR, LNX-VSEQ]
    requirement: "llvm-objdump recognizes and prints a mnemonic token for every spec mnemonic."
    pass_fail: "python3 impl/compiler/llvm/tests/analyze_coverage.py --fail-under 100 exits 0."

  - id: AVS-TOOL-010
    area: TOOL
    profiles: [LNX-S32, LNX-S64]
    requirement: "llvm-mc asm/disasm round-trip for curated canonical instruction forms."
    pass_fail: "Assemble -> disassemble -> map mnemonic back to same spec entry for curated set."

  - id: AVS-TOOL-011
    area: TOOL
    profiles: [LNX-S32, LNX-S64]
    requirement: "Spec decode vectors (99_spec_decode) disassemble with 100% mnemonic coverage."
    pass_fail: "analyze_coverage.py (auto-detected out-linx*) reports 100% coverage."

  - id: AVS-BLK-001
    area: BLK
    profiles: [LNX-S32, LNX-S64]
    requirement: "Safety rule: control-flow targets must land on a block start marker."
    pass_fail: "Jumping into the middle of a block traps with correct BPC/TPC capture."

  - id: AVS-BLK-002
    area: BLK
    profiles: [LNX-S32, LNX-S64]
    requirement: "Block boundary commit rules: blocks end at BSTOP/C.BSTOP or implicitly at next BSTART.*; BARG consulted at commit."
    pass_fail: "Directed programs show correct transitions with/without explicit BSTOP."

  - id: AVS-BLK-003
    area: BLK
    profiles: [LNX-S32, LNX-S64]
    requirement: "SETC.* validity: executing SETC.* before any block start is illegal or traps as block-format error."
    pass_fail: "SETC.* at reset TPC traps; SETC.* after a BSTART.* behaves correctly."

  - id: AVS-BLK-004
    area: BLK
    profiles: [LNX-S32, LNX-S64]
    requirement: "Call header adjacency: BSTART CALL and SETRET/C.SETRET are adjacent; violations trap or are rejected by toolchain."
    pass_fail: "Non-adjacent sequence triggers specified failure; compliant call returns correctly."

  - id: AVS-BLK-005
    area: BLK
    profiles: [LNX-VPAR, LNX-VSEQ]
    requirement: "Vector block types are BSTART.VPAR and BSTART.VSEQ; BSTART.VEC does not appear in golden/manual."
    pass_fail: "Repo contains no BSTART.VEC strings except as a negative requirement in AVS."

  - id: AVS-ALU-001
    area: ALU
    profiles: [LNX-S32, LNX-S64]
    requirement: "ADD/ADDI/SUB/SUBI basic correctness including edge cases."
    pass_fail: "Directed tests cover 0, -1, INT_MIN/INT_MAX, mixed sign; results match spec."

  - id: AVS-ALU-002
    area: ALU
    profiles: [LNX-S32, LNX-S64]
    requirement: "MUL/DIV/REM correctness including signedness and divide-by-zero behavior."
    pass_fail: "Directed tests cover DIV/DIVU/REM/REMU and *W forms; defined outcomes observed."

  - id: AVS-BR-001
    area: BR
    profiles: [LNX-S32, LNX-S64]
    requirement: "PC-relative target scaling uses halfword scaling (imm << 1) where defined."
    pass_fail: "Directed tests validate exact target addresses including negative offsets."

  - id: AVS-BR-002
    area: BR
    profiles: [LNX-S32, LNX-S64]
    requirement: "Indirect transitions consult SETC.TGT as specified."
    pass_fail: "Directed tests set different targets and observe correct dispatch."

  - id: AVS-MEM-001
    area: MEM
    profiles: [LNX-S32, LNX-S64]
    requirement: "Endianness is little-endian."
    pass_fail: "Store a multi-byte pattern and confirm byte/halfword/word loads observe expected ordering."

  - id: AVS-MEM-002
    area: MEM
    profiles: [LNX-S32, LNX-S64]
    requirement: "Alignment behavior (trap vs split) is specified and consistent for the profile."
    pass_fail: "Misaligned accesses match defined outcome across QEMU and RTL."

  - id: AVS-MEM-003
    area: MEM
    profiles: [LNX-S32, LNX-S64]
    requirement: "Scaled vs unscaled immediate offsets (.U) compute correct addresses."
    pass_fail: "Directed tests validate exact addresses touched by scaled and .U families."

  - id: AVS-ATOM-001
    area: ATOM
    profiles: [LNX-ATOM]
    requirement: "Atomic .aq/.rl qualifiers enforce acquire/release ordering as specified."
    pass_fail: "Litmus tests show forbidden outcomes do not occur when qualifiers are used."

  - id: AVS-ATOM-002
    area: ATOM
    profiles: [LNX-ATOM]
    requirement: "FENCE.D pred,succ orders the specified operation classes."
    pass_fail: "Litmus tests and microbench confirm ordering and no-op cases."

  - id: AVS-ATOM-003
    area: ATOM
    profiles: [LNX-ATOM]
    requirement: "FENCE.I synchronizes instruction fetch with prior stores that modify executable code."
    pass_fail: "Self-modifying-code test behaves as specified (or traps if unsupported; behavior must be defined)."

  - id: AVS-ATOM-010
    area: ATOM
    profiles: [LNX-ATOM]
    requirement: "Message passing requires acquire/release or fence to forbid r1=1,r2=0 outcome."
    pass_fail: "Litmus harness observes allowed/forbidden outcome sets per requirement."

  - id: AVS-ATOM-011
    area: ATOM
    profiles: [LNX-ATOM]
    requirement: "FENCE.D orders MMIO and Normal memory when O selected."
    pass_fail: "Directed test with MMIO model observes ordering consistent with fence definition."

  - id: AVS-SYS-001
    area: SYS
    profiles: [LNX-PRIV]
    requirement: "ACRC is last in block and routes/traps as specified."
    pass_fail: "Placement violation triggers defined trap; valid requests route to managing ring vector."

  - id: AVS-SYS-002
    area: SYS
    profiles: [LNX-PRIV]
    requirement: "ACRE restores state per manual (CSTATE, BPC, and optionally BSTATE/BARG)."
    pass_fail: "Trap handler returns and execution resumes at expected block start."

  - id: AVS-ABI-001
    area: ABI
    profiles: [LNX-S32, LNX-S64]
    requirement: "Calling convention correctness for leaf/non-leaf functions."
    pass_fail: "C tests validate callee-saved regs, stack alignment, and return values."

  - id: AVS-ABI-002
    area: ABI
    profiles: [LNX-S32, LNX-S64]
    requirement: "Varargs correctness for integers and (if enabled) floating-point."
    pass_fail: "Runtime tests match expected sums/prints and do not corrupt caller state."

  - id: AVS-FP-001
    area: FP
    profiles: [LNX-FP]
    requirement: "Scalar FP ops match IEEE-754 rounding and FCSR flag behavior."
    pass_fail: "Directed tests cover NaNs, +/-0, infinities, and flag setting/clearing."

  - id: AVS-FP-002
    area: FP
    profiles: [LNX-FP]
    requirement: "FP<->int conversions match spec for edge cases."
    pass_fail: "Directed tests validate exact bit patterns and trap/flag behavior."

  - id: AVS-VEC-001
    area: VEC
    profiles: [LNX-VPAR, LNX-VSEQ]
    requirement: "Vector ops that require a vector block trap when executed outside a vector block."
    pass_fail: "Vector op outside header traps; inside correct header executes and updates state."

  - id: AVS-VEC-002
    area: VEC
    profiles: [LNX-VPAR, LNX-VSEQ]
    requirement: "VPAR vs VSEQ legality is enforced for block-restricted ops."
    pass_fail: "VPAR-only op in VSEQ (and vice versa) triggers defined failure."

  - id: AVS-VEC-003
    area: VEC
    profiles: [LNX-VPAR, LNX-VSEQ]
    requirement: "C.BSTART.VPAR/VSEQ compressed fall-through markers begin new vector blocks."
    pass_fail: "Directed program uses compressed marker and subsequent vector ops execute."

  - id: AVS-EMU-001
    area: EMU
    profiles: [LNX-S32, LNX-S64]
    requirement: "Illegal encodings trap deterministically with no partial state committed."
    pass_fail: "Negative tests validate trap PC/cause and unchanged regs/memory."

  - id: AVS-EMU-010
    area: EMU
    profiles: [LNX-S32, LNX-S64]
    requirement: "Dynamic instruction histogram total is close to LINX_INSN_COUNT and both are reported."
    pass_fail: "run_benchmarks.py --dynamic-hist reports both totals and uses plugin total for percentages."
